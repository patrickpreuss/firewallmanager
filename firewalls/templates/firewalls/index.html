{% extends "firewalls/base.html" %}


{% block body %}

<div class="container">
	<div class="row">

		<!-- Rule Chart Follows Here -->
		<div class="col-md-12">
			<span><h3>Dashboard</h3></span>
			<hr>
		</div>
	</div>
	<div class="row">
		<div class="col-md-2">

			<canvas id="chart-area" width="300" height="300"/></canvas>
			<script>

				var doughnutProtoData = [
					{
						value: {{ badcount }},
						color:"#E9573F",
						highlight: "#FC6E51",
						label: "Failed Rules"
					},
					{
						value: {{ goodcount }},
						color: "#8CC152",
						highlight: "#A0D468",
						label: "Succesfull Rules"
					},

				];


			</script>
			<div class="blank">
				<span class="badge badge-failed">Failed Rules</span>
			</div>
			<div class="blank">
				<span class="badge badge-success">Successful Rules</span>
			</div>

		</div>


		<!-- Rule Chart Follows Here -->


		<!-- Protocol Chart Follows Here -->
		<div class="col-md-2 col-md-offset-2">
			<canvas id="chartproto-area" width="60" height="60"/></canvas>

			<script>

				var doughnutData = [
					{
						value: {{ tcpcount }},
						color:"#D770AD",
						highlight: "#EC87C0",
						label: "TCP Rules"
					},
					{
						value: {{ udpcount }},
						color: "#967ADC",
						highlight: "#AC92EC",
						label: "UDP Rules"
					},
					{
						value: {{ icmpcount }},
						color: "#37BC9B",
						highlight: "#48CFAD",
						label: "ICMP Rules"
					},

				];

				window.onload = function(){
					var ctxproto = document.getElementById("chartproto-area").getContext("2d");
					window.myDoughnut = new Chart(ctxproto).Pie(doughnutData, {responsive : true});

					var ctx = document.getElementById("chart-area").getContext("2d");
					window.myDoughnut = new Chart(ctx).Pie(doughnutProtoData, {responsive : true,});
				}



			</script>

			<div class="blank">
				<span class="badge badge-tcp">TCP Rules</span>
			</div>
			<div class="blank">
				<span class="badge badge-udp">UDP Rules</span>
				</div><div class="blank">
				<span class="badge badge-icmp">ICMP Rules</span>
			</div>
		</div>




		<!-- Protocol Chart Ends Here -->

		<!-- Information Summary Starts Here -->

		<div class="col-md-3 col-md-offset-3">
			<ul class="list-group">
				<li class="list-group-item"><span class="glyphicon glyphicon-list" aria-hidden="true"></span>&nbsp; Number of Rules<span class="badge">{{rulecount}}</span></li>
				<li class="list-group-item"><span class="glyphicon glyphicon glyphicon-tasks" aria-hidden="true"></span>&nbsp; Number of Hosts<span class="badge">{{hostcount}}</span></li>
				<li class="list-group-item"><span class="glyphicon glyphicon glyphicon-th" aria-hidden="true"></span>&nbsp; Number of Clusters<span class="badge">{{clustercount}}</span></li>
				<li class="list-group-item"><span class="glyphicon glyphicon glyphicon-globe" aria-hidden="true"></span>&nbsp; Number of Locations<span class="badge">{{locationcount}}</span></li>
				<li class="list-group-item"><span class="glyphicon glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>&nbsp; Number of Failed Rules<span class="badge">{{badcount}}</span></li>
				<li class="list-group-item"><span class="glyphicon glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>&nbsp; Number of Good Rules<span class="badge">{{goodcount}}</span></li>

			</ul>
		</div>

		<!-- Information Summary Ends Here -->


	</div>

</div>


<!-- Table block starts here -->

<div class="container">
  <div class="row">
    <div class="col-md-12">
      {% if rule_list %}
      <table class="table table-hover" data-pagination="true" data-toggle="table"  data-search="true" data-show-export="true" data-show-toggle="true"  data-show-columns="true" data-smart-display="true" data-show-filter="true" data-toolbar="toolbar">
        <thead>
          <tr>
            <th data-field="id" data-sortable="true">Rule ID</th>
            <th data-sortable="true">Source</th>
            <th data-sortable="true">Destination</th>
            <th data-sortable="true">Source IP</th>
            <th data-sortable="true">Dest. IP</th>
            <th data-sortable="true">Port #</th>
            <th data-sortable="true">Conn Type</th>
            <th data-sortable="true">Approval</th>
            <th data-sortable="true">Status</th>
            <th data-sortable="true">Last update</th>
          </tr>
        </thead>
        {% for rule in rule_list %}
        <tr>
          <td>{{ rule.id }}</td>
          <td>{{ rule.source }}</td>
          <td>{{ rule.destination }}</td>
          <td>{{ rule.source_ip }}</td>
          <td>{{ rule.destination_ip }}</td>
          <td>{{ rule.port_number }}</td>
          <td>{{ rule.connection_type }}</td>
          <td>{{ rule.approved }}</td>

          {% if rule.status %}
          <td class="text-center goodrule"><i class="fa fa-check fa-lg"></i></td>
          {% else %}
          <td class="text-center badrule"><i class="fa fa-close fa-lg"></i></td>
          {% endif %}
          <td>{{ rule.last_updated }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <p> No polls are available. </p>
        {% endif %}
      </table>
    </div>
  </div>
</div>
<!-- Table block ends here -->


<div class="container">
	<div class="row">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Network Graph</h3>
			</div>
			<div class="panel-body">
				<div id="visualization"></div>
				<script type="text/javascript">
					// create an array with nodes
				var nodes = [
				{% for node in hosts %}
					{id: {{node.id}}, label: '{{node.host_name}}', group: '{{node.host_name}}', shape: 'dot', title: 'IP Address: {{node.ip_address}}<br>Cluster:  {{node.cluster}}'},
				{% endfor %}
	];

	// create an array with edges
	var edges = [
		{% for rule in rule_list %}
			{% if rule.status %}
				{from: {{rule.source.id}}, to: {{rule.destination.id}},style: 'arrow', label: '{{rule.port_number}}/{{rule.connection_type}}',length: 500},
		{% else %}
			{from: {{rule.source.id}}, to: {{rule.destination.id}},style: 'dash-line', label: '{{rule.port_number}}/{{rule.connection_type}}',length: 500},
		{% endif %}
		{% endfor %}

	];

	//var options = {
	//width: '400px',
	//height: '500px',
	//stabilize: true,
	//hierarchicalLayout: {
	//  direction: 'UD'
	//}
	//};

	//var options = {height: '500px', physics: {barnesHut: {gravitationalConstant: -8400, centralGravity: 0.65, springLength: 164, springConstant: 0.0227, damping: 0.3}}, smoothCurves: true};
	var options = {height: '500px', physics: {barnesHut: {gravitationalConstant: -8400}}, smoothCurves: false};
	// create a network
	var container = document.getElementById('visualization');
	var data = {
		nodes: nodes,
		edges: edges
	};
	var network = new vis.Network(container, data, options);
				</script>
			</div>
		</div>

	</div>
</div>



<div class="container-fluid">
	<div class="row">
		<div class="col-lg-5 col-lg-offset-4">
			<hr>

			<p>Best viewed in anything but Internet Explorerâ„¢ Seriously, please consider switching.</p>
			<img src="../../static/firewalls/img/brw-chrome.png" alt="" />
			<img src="../../static/firewalls/img/brw-firefox.png" alt="" />
			<img src="../../static/firewalls/img/brw-safari-01.png" alt="" />
			<img src="../../static/firewalls/img/brw-opera.png" alt="" />
			<hr>

		</div>
	</div>
</div>


{% endblock %}
